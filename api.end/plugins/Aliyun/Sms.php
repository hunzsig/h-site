<?php
namespace plugins\Aliyun; require_once __DIR__. '/api_sdk/vendor/autoload.php'; use Aliyun\Core\Config; use Aliyun\Core\Profile\DefaultProfile; use Aliyun\Core\DefaultAcsClient; use Aliyun\Api\Sms\Request\V20170525\SendSmsRequest; use Aliyun\Api\Sms\Request\V20170525\QuerySendDetailsRequest; Config::load(); class Sms{ static $acsClient = null; public static function getAcsClient($accessKeyId,$accessKeySecret){ if(!$accessKeyId || !$accessKeySecret){ throw new \Exception('lose access'); } $product = "Dysmsapi"; $domain = "dysmsapi.aliyuncs.com"; $region = "cn-hangzhou"; $endPointName = "cn-hangzhou"; if(static::$acsClient == null) { $profile = DefaultProfile::getProfile($region, $accessKeyId, $accessKeySecret); DefaultProfile::addEndpoint($endPointName, $region, $product, $domain); static::$acsClient = new DefaultAcsClient($profile); } return static::$acsClient; } public static function sendSms($ak,$sk,$signName, $templateCode, $phoneNumbers, $templateParam = null, $outId = null, $smsUpExtendCode = null) { $request = new SendSmsRequest(); $request->setPhoneNumbers($phoneNumbers); $request->setSignName($signName); $request->setTemplateCode($templateCode); if($templateParam) { $request->setTemplateParam($templateParam); } if($outId) { $request->setOutId($outId); } if($smsUpExtendCode) { $request->setSmsUpExtendCode($smsUpExtendCode); } $acsResponse = static::getAcsClient($ak,$sk)->getAcsResponse($request); $acsResponse = (array)$acsResponse; return $acsResponse; } public function queryDetails($phoneNumbers, $sendDate, $pageSize = 10, $currentPage = 1, $bizId=null) { $request = new QuerySendDetailsRequest(); $request->setPhoneNumber($phoneNumbers); $request->setBizId($bizId); $request->setSendDate($sendDate); $request->setPageSize($pageSize); $request->setCurrentPage($currentPage); $acsResponse = static::getAcsClient()->getAcsResponse($request); return $acsResponse; } } 